import { patch, unpatch } from "netmd-js";
import { Exploit } from "../exploit";

export class KillEepromWrite extends Exploit{
    public static _name = "KillEepromWrite";
    protected getPropertyStore() {
        return {
            spiWriteEEPROM: {
                "S1.600": 0x0001e58c,
            },
            bxLR: {
                "*": new Uint8Array([0x70, 0x47, 0x70, 0x47]),
            },
        }
    }

    protected patch: number = -1;

    async init(){
        await super.init();
        this.patch = this.stateManager.getIncrementalPatchNumber();
    }

    async enable(){
        await patch(
            this.factoryIface,
            this.getProperty("spiWriteEEPROM"),
            this.getProperty("bxLR"),
            this.patch,
            this.stateManager.getMaxPatchesAmount()
        );
    }

    async disable(){
        await unpatch(
            this.factoryIface,
            this.patch,
            this.stateManager.getIncrementalPatchNumber()
        );
    }
}

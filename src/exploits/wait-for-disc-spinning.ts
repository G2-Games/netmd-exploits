import { Exploit, VersionPropertyStore } from "../exploit";
import { USBCodeExecution } from "./usb-code-execution";

export class WaitForDiscToStopSpinning extends Exploit {
    static _name = "WaitForDiscToStopSpinning";

    protected getPropertyStore(): VersionPropertyStore {
        return {
            code: {
                'S*': `
                    @fw_compat_bridge

                    adr r0, temp
                    mov r1, #7
                    mov r2, #1
                    lsl r2, r2, #27
                    mov r3, #0
                    mvn r4, #0
                    @bxar r4, $tron_twai_flg
                    
                    temp: .word 0

                    ; tron_twai_flg(&temp, 7, 1 << 27, TWF_ANDW, -1);
                `
            }
        };
    }

    async wait(){
        const usbCodeExec = await this.stateManager.require(USBCodeExecution);
        await usbCodeExec.execute(this.assembleProperty("code"));
    }
}

